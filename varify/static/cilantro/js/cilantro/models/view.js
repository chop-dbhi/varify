define(["underscore","backbone","../core","./base"],function(t,e,n,o){var r=e.Model.extend({idAttribute:"concept"}),s=e.Collection.extend({model:r}),i=o.Model.extend({constructor:function(){this.facets=new s,this.on("change:json",function(t,e){return this.jsonToFacets(e)}),o.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var t=this;return this.on("request",function(){return n.trigger(n.VIEW_SYNCING,this)}),this.on("sync",function(t,e,o){return o||(o={}),o.silent!==!0?n.trigger(n.VIEW_SYNCED,this,"success"):void 0}),this.on("error",function(){return n.trigger(n.VIEW_SYNCED,this,"error")}),this.on("change",function(){return n.trigger(n.VIEW_CHANGED,this)}),n.on(n.VIEW_SAVE,function(e){return t.id===e||!e&&t.isSession()?t.save():void 0})},isSession:function(){return this.get("session")},isArchived:function(){return this.get("archived")},toJSON:function(){var t=o.Model.prototype.toJSON.apply(this,arguments);return t.json=this.facetsToJSON(),t},parse:function(t){return o.Model.prototype.parse.apply(this,arguments),this.jsonToFacets(t.json),t},jsonToFacets:function(e){if(e||(e={}),t.isArray(e))return void this.facets.reset(e);for(var n,o,r,s=[],i=e.columns||[],c=e.ordering||[],u=0;u<i.length;u++){o=i[u],n={concept:o};for(var a=0;a<c.length;a++)r=c[a],o===r[0]&&(n.sort=r[1],n.sort_index=a);s.push(n)}return this.facets.reset(s)},facetsToJSON:function(){var t={ordering:[],columns:[]};return this.facets.each(function(e){var n,o,r;return t.columns.push(e.get("concept")),(n=e.get("sort"))?(o=e.get("sort_index"),r=[e.get("concept"),n],t.ordering.splice(o,0,r)):void 0}),t}}),c=o.SessionCollection.extend({model:i});return{ViewModel:i,ViewCollection:c}});
//# sourceMappingURL=view.js.map