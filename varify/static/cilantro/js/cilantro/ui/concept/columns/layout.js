define(["jquery","underscore","backbone","marionette","../search","./available","./selected"],function(e,t,i,s,o,n,a){var l=s.ItemView.extend({className:"popover right",template:"concept/popover",initialize:function(){this.$el.css({position:"fixed",zIndex:1200,minWidth:300,minHeight:100}).hide()},serializeData:function(){var e=this.model.toJSON(),t=this.model.fields;return 0===t.length?e.description||(e.description='<i class="icon-spinner icon-spin"></i>'):1===t.length?e.description||(e.description=t.models[0].get("description")):e.fields=t.map(function(e){return e.get("name")}).join(", "),e.description||e.fields||(e.description="<em>No description is available</em>"),e},onRender:function(){0===this.model.fields.length&&(this.listenTo(this.model.fields,"reset",this.show),this.model.fields.fetch({reset:!0}))},update:function(e){this.stopListening(),this.options=e,this.model=e.model,this.show()},show:function(){this.render(),this.shown()?this.$el.stop().animate({left:this.options.left,top:this.options.top-this.$el.outerHeight()/2},200):this.$el.show().css({left:this.options.left,top:this.options.top-this.$el.outerHeight()/2}).fadeIn(200)},shown:function(){return this.$el.is(":visible")},hide:function(){this.$el.fadeOut(200)}}),c=s.Layout.extend({className:"concept-columns",template:"concept/columns/layout",events:{click:"hideDetailsPopover","click [data-action=clear]":"triggerRemoveAll"},regions:{search:".search-region",available:".available-region",selected:".selected-region"},regionViews:{search:o.ConceptSearch,available:n.AvailableColumns,selected:a.SelectedColumns},initialize:function(){if(this.data={},!(this.data.view=this.options.view))throw new Error("view required");if(!(this.data.concepts=this.options.concepts))throw new Error("concepts collection required");this.listenTo(this.data.concepts,"columns:detail",this.handleDetailsPopover),this.data.selected=new i.Collection,this.data.selected.listenTo(this.data.concepts,"columns:add",function(e){this.add(e)}),this.data.selected.on("columns:remove",function(e){this.remove(e)})},handleDetailsPopover:function(i,s){var o=this,n=e(s.currentTarget);if(clearTimeout(this._detailsDelay),"mouseover"===s.type){var a=this.popover.shown()?100:500;this._detailsDelay=t.delay(function(){o.showDetailsPopover(i,n)},a)}else"mouseout"===s.type&&(this._detailsDelay=t.delay(function(){o.hideDetailsPopover(i,n)},200))},showDetailsPopover:function(t,i){i=e(i);var s=i.offset();this.popover.update({model:t,top:s.top+i.outerHeight()/2,left:s.left+i.outerWidth()})},hideDetailsPopover:function(){this.popover&&this.popover.hide()},resetSelected:function(){this.data.selected.reset();var e=this.data.concepts;this.data.view.facets.each(function(t){var i=e.get(t.get("concept"));i&&i.trigger("columns:add",i)})},selectedToFacets:function(){var e=this;return this.data.selected.map(function(t){var i=e.data.view.facets.get(t.id);return i?i.toJSON():{concept:t.id}})},onRender:function(){this.$el.modal({show:!1});var e=new this.regionViews.search({placeholder:"Search available columns by name, description, or data value...",collection:this.data.concepts,handler:function(e,i){t.filter(e,i)}}),t=new this.regionViews.available({collapsable:!1,collection:this.data.concepts}),i=new this.regionViews.selected({collection:this.data.selected});this.search.show(e),this.available.show(t),this.selected.show(i),this.popover=new l,this.$el.append(this.popover.el),this.data.view.facets.length>0&&this.data.concepts.length?this.resetSelected():(this.listenToOnce(this.data.view.facets,"reset",this.resetSelected),this.listenToOnce(this.data.concepts,"reset",this.resetSelected))},triggerRemoveAll:function(){var e=this.data.selected.slice(0);t.each(e,function(e){e.trigger("columns:remove",e)})}});return{ConceptColumnsLayout:c}});
//# sourceMappingURL=layout.js.map